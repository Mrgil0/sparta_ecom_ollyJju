<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap"
        rel="stylesheet" />
    <!-- icon -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v3.0.1/css/line.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.dev.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../css/home.css" type="text/css">
    <link rel="stylesheet" href="../css/header.css" type="text/css">
    <link rel="stylesheet" href="../css/chatroom.css" type="text/css">
    <link rel="stylesheet" href="../css/sidebar.css" type="text/css">
</head>

<body>
    <%-include('component/header.ejs')%>
    <section class="home" i="home">

        <div class="home-text">
            <img src="../images/bag.jpg">
            <h1>귀염뽀짝 <br><span>신상잔치</span></h1>
            <p>어쩌구 저쩌구 라라라라</p>
            <!-- <a href="#" class="btn">보러가기</a> -->
        </div>
    </section>

    <section class="featured" id="featured">
        <div class="center-text">
            <h2>신상봐라 바라밤</h2>
        </div>

        <div id="newProduct" class="featured-content">
            
        </div>
        <div class="center-text">
            <h2>베스트셀러</h2>
        </div>
        <div id="bestProduct" class="featured-content2">

        </div>
    </section>
    <%-include('component/sidebar.ejs')%>


    <script src="../js/sticky-bar.js" type="text/javascript"></script>
    <script src="../js/chatroom.js" type="text/javascript"></script>
    <script src="../js/sidebar.js" type="text/javascript"></script>
    <script>
        let socket = io.connect('ws://localhost:3001')
        $('#msg').keyup(function(event){
            if(event.which == 13){
                "<%if(user) {%>"
                socket.emit('join_room', (param = {user_key: "<%-(user.user_email)%>"}))
                socket.emit('chat_message', {user_key: "<%-(user.user_email)%>", message: $('#msg').val()});
                let msgLine = $('.msgLine');
				let msgBox = $('.me');

				msgBox.append($('#msg').val());
				msgLine.append(msgBox);

				$('#chatView').append(msgLine);
                $('#msg').val('');
                "<% } %>"
            }	
        })
    </script>
</body>
<script>
    $(document).ready(function () {
        show_newProduct();
        show_bestProduct();
    })

    function show_newProduct() {
        $.ajax({
            type: "GET",
            url: "/product/index",
            data: {},
            success: function (response) {
                let rows = response["data"];

                for (let i = 0; i < 4; i++) {
                    let Image = rows[i]["productImage"];
                    let nickname = rows[i]["productName"];
                    let price = rows[i]["price"];

                    let temp_html = `
                        <div class="row">
                            <img src="/${Image}">
                            <div class="fea-text">
                                <h5>${nickname}</h5>
                                <p>${price}</p>
                            </div>
                        </div>
                    `
                    $('#newProduct').append(temp_html);
                }

                for (let i = 4; i < rows.length; i++) {
                    let Image = rows[i]["productImage"];
                    let nickname = rows[i]["productName"];
                    let price = rows[i]["price"];
                    
                    let temp_html = `
                        <div class="row">
                            <img src="/${Image}">
                            <div class="fea-text">
                                <h5>${nickname}</h5>
                                <p>${price}</p>
                            </div>
                        </div>
                    `

                    $('#bestProduct').append(temp_html);
                }
            }
        })
    }
    
    function show_bestProduct() {
        $.ajax({
            type: "GET",
            url: "/product/index",
            data: {},
            success: function (response) {
                let rows = response["data"];
                
                for (let i = 4; i < rows.lenth; i++) {
                    let Image = rows[i]["productImage"];
                    let nickname = rows[i]["productName"];
                    let price = rows[i]["price"];
                    let temp_html = `
                        <div class="row">
                            <img src="/${Image}">
                            <div class="fea-text">
                                <h5>${nickname}</h5>
                                <p>${price}</p>
                            </div>
                        </div>
                    `

                    $('#bestProduct').append(temp_html);
                }
            }
        })
    }
</script>
</html>